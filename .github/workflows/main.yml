name: Web E2E Tests

on:
  workflow_dispatch: # permite execuÃ§Ã£o manual
  push:
    branches: [main] # opcional: executa nos commits para main
  pull_request:
    branches: [main]

jobs:
  e2e-tests:
    runs-on: ubuntu-latest

    steps:
      # ðŸ§© 1. Clonar o projeto
      - name: Checkout do cÃ³digo
        uses: actions/checkout@v4

      # ðŸ§© 2. Configurar Node.js (garante ambiente consistente)
      - name: Configurar Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18' # ajuste conforme o projeto

      # ðŸ§© 3. Verificar versÃ£o instalada
      - name: Verificar versÃ£o do Node
        run: node --version

      # ðŸ§© 4. Instalar dependÃªncias
      - name: Instalar dependÃªncias
        run: npm ci

      # ðŸ§© 5. Garantir que o supportFile do Cypress exista
      - name: Garantir arquivo de suporte Cypress
        run: |
          mkdir -p cypress/support
          if [ ! -f cypress/support/e2e.js ]; then
            echo "// Arquivo criado automaticamente para evitar erro de suporte" > cypress/support/e2e.js
          fi

      # ðŸ§© 6. Executar testes E2E
      - name: Executar Cypress
        run: npx cypress run

      # ðŸ§© 7. Upload dos relatÃ³rios e artefatos
      - name: Upload de relatÃ³rios
        if: ${{ !cancelled() }}
        uses: actions/upload-artifact@v4
        with:
          name: relatorios
          path: |
            cypress/reports
            cypress/screenshots
            cypress/videos
